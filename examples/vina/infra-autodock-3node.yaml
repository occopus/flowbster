infra_name: autodock-3node
user_id: zfarkas@sztaki.hu

variables:
    flowbster_global:
            collector_ip: &collectorip 192.168.153.200
            collector_port: &collectorport 5001
            receiver_port: &receiverport 5000

nodes:
    - &GENERATOR
        name: GENERATOR
        type: flowbster_node
        scaling:
                min: 1
                max: 1
        variables:
            flowbster:
                app:
                    exe:
                        filename: execute.bin
                        tgzurl: https://www.dropbox.com/s/2l3pkmxfb8k6wsc/generator_exe.tgz?dl=1
                    args: '64'
                    in:
                        -
                            name: input-ligands.zip
                        -
                            name: vina-config.txt
                        -
                            name: input-receptor.pdbqt
                    out:
                        -
                            name: output.zip
                            filter: "output.zip*"
                            distribution: random
                            targetname: ligands.zip
                            targetnode: Vina
                        -
                            name: config.txt
                            targetname: config.txt
                            targetnode: Vina
                        -
                            name: receptor.pdbqt
                            targetname: receptor.pdbqt
                            targetnode: Vina
    - &Vina
        name: Vina
        type: flowbster_node
        scaling:
                min: 1
                max: 1
        variables:
            flowbster:
                app:
                    exe:
                        filename: vina.run
                        tgzurl: https://www.dropbox.com/s/d7xyrrkiej1xhw6/vina_exe.tgz?dl=1
                    args: ''
                    in:
                        -
                            name: ligands.zip
                        -
                            name: config.txt
                        -
                            name: receptor.pdbqt
                    out:
                        -
                            name: output.tar
                            targetname: output.tar
                            targetnode: COLLECTOR
    - &COLLECTOR
        name: COLLECTOR
        type: flowbster_node
        scaling:
                min: 1
                max: 1
        variables:
            flowbster:
                app:
                    exe:
                        filename: execute.bin
                        tgzurl: https://www.dropbox.com/s/rf9h5kppah2y4s5/collector_exe.tgz?dl=1
                    args: '5'
                    in:
                        -
                            name: output.tar
                            collector: true
                            format: "output.tar_%i"
                    out:
                        -
                            name: best.pdbqt
                            targetname: COLLECTOR_result
                            targetip: *collectorip
                            targetport: *collectorport

dependencies:
    -
        connection: [ *GENERATOR, *Vina ]
    -
        connection: [ *Vina, *COLLECTOR ]
